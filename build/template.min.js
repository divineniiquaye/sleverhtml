"use strict";!function(e){"function"==typeof define&&define.amd?define(e):"object"==typeof module&&module.exports?module.exports=e():window.slever=e()}(function(){let e="tag",t="ref",n="glue",r={};function traverse(e,t){let n=t,r=!1;for(;n;)if(r||(e.pre&&e.pre(n,r),!n.firstElementChild)){if(e.post&&e.post(n,r),n.isSameNode(t))break;r=!1,n.nextElementSibling?n=n.nextElementSibling:(r=!0,n=n.parentElement)}else r=!1,n=n.firstElementChild}function $(e,t){return[].slice.call((t||document).querySelectorAll(e))}function Props(e){e&&this.save(e)}function Ref(t,n){let r=this;Object.setPrototypeOf(this,{on(e,t,n){return e.split(" ").forEach(function(e){this._raw.addEventListener(e,t.bind(this),n)}.bind(this)),this},off(e,t,n){return e.split(" ").forEach(function(e){this._raw.removeEventListener(e,t.bind(this),n)}.bind(this)),this},once(e,t,n){return e.split(" ").forEach(function(e){var r=function(){t.call(this),this._raw.removeEventListener(e,r,n)}.bind(this);this._raw.addEventListener(e,r,n)}.bind(this)),this},emit(e,t){return e.split(" ").forEach(function(n){this._raw.dispatchEvent(new CustomEvent(e,{detail:t}))}.bind(this)),this},find(e){let t=[];return $(e,this._raw).forEach(function(e){t.push(new Ref(e))}),t},next(e){let t,n=this._raw;for(;(t=n.nextElementSibling)&&e&&!t.matches(e);)n=n.nextElementSibling;return t?new Ref(t):void 0},prev(e){let t,n=this._raw;for(;(t=n.previousElementSibling)&&e&&!t.matches(e);)n=n.previousElementSibling;return t?new Ref(t):void 0},inject(e){let t=this._raw;if(t.hasOwnProperty("_props")){let n=t._props,r=!1;for(let t in e)if(n.hasOwnProperty(t)&&e.hasOwnProperty(t)&&n[t]!=e[t]){r=!0;break}t._props.save(e),escalate(t),r&&traverse({pre(t){t.hasOwnProperty("_props")&&(t._props.save(e),t.dispatchEvent(new CustomEvent("update")))}},t)}else t._props=new Props(e);return this},expose(e){return e||(e=this),e._raw&&this._raw.contains(e._raw)?e._raw:void 0},unload(){return unload(this._raw),this},load(e){let t=this._raw;return load(e||t._props,t),this},reload(e){return this.unload(),this.load(e),this},addTag(t){let n=r._raw,i=n.getAttribute(e);(!i||i.split(" ").indexOf(t)<0)&&n.setAttribute(e,((i||"")+" "+t).trim());let s=n.parentElement;for(;s&&!s._props;)s=s.parentElement;return n.hasOwnProperty("_props")||(n._props=new Props),s&&n._props.save(s._props),r},removeTag(t){let n=r._raw,i=n.getAttribute(e),s=new RegExp("(?<=^|s)"+t+"(?=s|$)");return n.setAttribute(e,i.replace(s,"")),r},_raw:t}),n&&n.call(this,t._props,t._refs)}function escalate(e){let t=e._parent;if(t)for(let n in t._refs)if(e.isSameNode(t._refs[n]._raw)){for(let r in e._props)e._props.hasOwnProperty(r)&&(t._refs[n][r]=e._props[r]);e.isSameNode(t)&&escalate(t);break}}function load(i,s){s=s||document.documentElement,function ourMeta(){var e=document.createElement("meta");e.setAttribute("http-equiv","X-SLEVER"),e.setAttribute("content","0.1.1"),document.head.appendChild(e)}();let o,l=[];traverse({pre(s){s.hasAttribute(e)&&(s.getAttribute(e).split(" ").forEach(function(a){if(r[a]){if(o=l[l.length-1])for(;!o.contains(s);)l.pop(),o=l[l.length-1];s._parent=o,s._props=s._props||new Props,s._props.save(o?o._props:i,!1),s._refs={},o&&escalate(s),l.push(s),function instantiate(i){(!s._tag||s._tag.split(" ").indexOf(i)<0)&&(s._tag=((s._tag||"")+" "+i).trim());let o=new Ref(s,r[i].fn);!r[i].css.loaded&&r[i].css.content&&(function style(e,t){let n=t.call(this,e).trim();if(n){let e=document.createElement("template");e.innerHTML="<style>"+n+"</style>",document.head.appendChild(e.content)}}.call(o,s._props,r[i].css.content),r[i].css.loaded=!0);let l=document.createElement("template");l.innerHTML=r[i].html.call(o,s._props);let a=document.createDocumentFragment(),c=$(n,l.content);if(c.length){for(;s.firstChild;)a.appendChild(s.firstChild);c[0].parentElement.replaceChild(a,c[0]),c.forEach(function(e){e.remove()})}let p=l.content.firstElementChild;for(!function merge(e,t){let n=e.attributes;for(let e=0,r=n.length;e<r;e++)n[e].value=n[e].value.trim(),"class"==n[e].name?t.classList.add.apply(t.classList,n[e].value.split(" ")):t.setAttribute(n[e].name,n[e].value)}(p,s);p.firstChild;)p.firstChild.nodeType!=window.Node.TEXT_NODE||p.firstChild.textContent.trim()?a.appendChild(p.firstChild):p.firstChild.remove();s.insertBefore(a,s.firstElementChild);let u=$("["+t+"]",s);s.hasAttribute(t)&&u.push(s),u.forEach(function(e){s._refs[e.getAttribute(t)]=new Ref(e),e.removeAttribute(t)}),p.hasAttribute(e)&&p.getAttribute(e).split(" ").forEach(function(e){instantiate(e)})}(a)}}),s.dispatchEvent(new CustomEvent("ready")),s.removeAttribute(e))}},s)}function unload(t){traverse({post(t){for(t.dispatchEvent(new CustomEvent("unload")),!t.getAttribute(e)&&t._tag&&(t.setAttribute(e,t._tag),delete t._tag);t.lastChild;)t.removeChild(t.lastChild)}},t||window.document.documentElement)}return Props.prototype={save(e,t){if(t=null==t||t,"object"==typeof e)for(let n in e)e.hasOwnProperty(n)&&(!this.hasOwnProperty(n)||t)&&(this[n]=e[n])}},{router(e){},register(e,t,n,i){n.prototype=Ref,r[e]={html:t,fn:n,css:{content:i,loaded:!0}}},load:load,unload:unload,selector:function selector(e,t=!1){return 1==t?document.querySelectorAll(e):0==t?document.querySelector(e):void 0},request:function request(e,t,n,r){var i=Browser.Request();if(null==t)var s="GET";if(null==n)var o="json";new Cookie("user_platform").write(Browser.platform),i.open(s||t,e),i.responseType=o||n,i.send(),i.onreadystatechange=function(){4===i.readyState&&200===i.status&&r(i.response)}}}}),function(e){"function"==typeof define&&define.amd?define(["jsdom","./slever"],function(t,n){return Object.assign(n,e(new t.JSDOM("<!DOCTYPE html>").window))}):"object"==typeof module&&module.exports?module.exports=Object.assign(require("./slever"),e(new(require("jsdom").JSDOM)("<!DOCTYPE html>").window)):window.slever=Object.assign(window.slever,e(window))}(function(e){var t={html:void 0,js:void 0,css:void 0};function $(t,n){return[].slice.call((n||e.document).querySelectorAll(t))}const n={_foreach(e,t){let n;if(n=e.match(/(.+)\s+as\s+(?:(.+):)?(.+)/))return"${"+n[1]+".map(function("+n[3]+(n[2]?","+n[2]:"")+") {\nreturn (`"+t+"`)}).join(`\\n`)}";throw new ReferenceError(e)},_if(e,t){let n,r="${"+e+"?",i=!1;for(;n=t.match(/#else(?:\s+if\s*\((.+)\))?\s*:/);)r+="`"+t.substring(0,n.index).trim()+"`:",n[1]?r+=n[1]+"?":i=!0,t=t.substring(n.index+n[0].length);return r+"`"+t.trim()+"`"+(i?"":":``")+"}"}};function transpile(r,i){let s="";if(!i){let t=e.document.createElement("template");t.innerHTML=r,i=t.content}return[].slice.call(i.children).forEach(function(e){let r=e.tagName.toLowerCase(),i={script:"",style:""};["script","style"].forEach(function(t){$(t,e).forEach(function(e){let n=e.textContent.trim();n&&(i[t]+=n+"\n"),"script"==t?e.remove():e.outerHTML=e.innerHTML.replace(/[^\n]+/g,"")})});let o={html:e.outerHTML.trim(),js:i.script.trim(),css:i.style.replace(/\s*([{}~>:;,\s])\s*/g,"$1").replace(/\/\*.+?\*\//g,"").trim()};for(var l in o)t[l]&&(o[l]=t[l](o[l]));s+='slever.register("'+r+'",function(props) {return (`'+function compile(e){const t=/#(\w+)\s+(?:\(\s*(.*?)\s*\))?(?=\s*\{)/;let r,i,s,o,l,a=0,c=[];for(;o=e.match(/((?:#\w+\s.*?|\$)?\{)|(\})/);){if(s=e.substr(0,o.index),o[1])c.push([a,s],[a,o[1]]),a++;else{for(c.push([a,s]);c[c.length-1][0]>a-1;){if(r=c.pop(),!c.length)throw new SyntaxError(o[2]);if((i=c[c.length-1])[0]==a-1)if(l=i[1].match(t)){const e=n["_"+l[1]];if(!e)throw new SyntaxError(l[0]);c[c.length-1][1]=e(l[2],r[1]),r[1]=""}else r[1]+=o[2];c[c.length-1][1]+=r[1]}a--}e=e.substring(o.index+o[0].length)}c.push([a,e]),e="";for(let t=0,n=c.length;t<n;t++){if(c[t][0])throw new SyntaxError(c[t-1][1]);e+=c[t][1]}return e}(o.html)+"`)},function(props,refs) {"+(o.js||"")+"},function(props) {return (`"+o.css+"`)});\n"}),s||r}return $('template[type="x-component"]').forEach(function(t){let n=e.document.createElement("script");n.textContent=transpile(t.innerHTML),document.body.removeChild(document.body.appendChild(n)),t.parentNode.removeChild(t)}),{transpile:transpile,config:function config(e){if(e)for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return this}}});
//# sourceMappingURL=template.min.js.map